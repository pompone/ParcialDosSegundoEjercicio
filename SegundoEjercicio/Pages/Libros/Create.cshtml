@page
@model SegundoEjercicio.Pages.Libros.CreateModel
@{
    ViewData["Title"] = "Nuevo libro";
}
<h2>Nuevo libro</h2>

<form method="post" class="row g-3">
    <div class="col-md-6">
        <label asp-for="Book.Title" class="form-label">Título</label>
        <input asp-for="Book.Title" class="form-control" />
        <span asp-validation-for="Book.Title" class="text-danger"></span>
    </div>

    <!-- Autor con “Otro…” -->
    <div class="col-md-3">
        <label class="form-label">Autor</label>
        <select asp-for="Book.AuthorId" asp-items="Model.Authors"
                class="form-select" id="AuthorSelect">
            <option value="">-- Seleccionar --</option>
            <option value="__other">Otro…</option>
        </select>
        <input type="text" class="form-control mt-2 d-none" id="NewAuthorInput"
               name="NewAuthorName" placeholder="Escribí el nuevo autor" />
    </div>

    <!-- Categoría con “Otro…” -->
    <div class="col-md-3">
        <label class="form-label">Categoría</label>
        <select asp-for="Book.CategoryId" asp-items="Model.Categories"
                class="form-select" id="CategorySelect">
            <option value="">-- Seleccionar --</option>
            <option value="__other">Otro…</option>
        </select>
        <input type="text" class="form-control mt-2 d-none" id="NewCategoryInput"
               name="NewCategoryName" placeholder="Escribí la nueva categoría" />
    </div>

    <div class="col-md-2">
        <label class="form-label">Año de publicación</label>
        <input asp-for="Book.PublishedYear" class="form-control" />
    </div>

    <div class="col-md-4">
        <label class="form-label">ISBN</label>
        <input asp-for="Book.ISBN" class="form-control" />
    </div>

    <div class="col-md-2">
        <label class="form-label">Ejemplares disponibles</label>
        <input asp-for="Book.CopiesAvailable" class="form-control" />
    </div>

    <div class="col-12 d-flex gap-2">
        <button type="submit" class="btn btn-primary">Guardar</button>
        <a class="btn btn-secondary" asp-page="Index">Volver</a>
    </div>
</form>

@section Scripts {
    
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Autor: si selecciona “Otro…”, muestro textbox y evito que se postee AuthorId
        const authorSel = document.getElementById('AuthorSelect');
        const authorInp = document.getElementById('NewAuthorInput');

        // Categoría: igual
        const catSel = document.getElementById('CategorySelect');
        const catInp = document.getElementById('NewCategoryInput');

        function toggleOther(selectEl, inputEl, fieldName) {
          if (selectEl.value === '__other') {
            inputEl.classList.remove('d-none');
            inputEl.required = true;
            // Evita choque de validación: cambiamos el name del select
            selectEl.name = 'Ignore_' + fieldName;
          } else {
            inputEl.classList.add('d-none');
            inputEl.required = false;
            selectEl.name = fieldName; // restaurar
          }
        }

        function init() {
          toggleOther(authorSel, authorInp, 'Book.AuthorId');
          toggleOther(catSel, catInp, 'Book.CategoryId');
        }

        authorSel.addEventListener('change', () => toggleOther(authorSel, authorInp, 'Book.AuthorId'));
        catSel.addEventListener('change', () => toggleOther(catSel, catInp, 'Book.CategoryId'));
        init(); 
    </script>
}
